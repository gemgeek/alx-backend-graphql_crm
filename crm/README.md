# CRM Project - Celery Setup

This document outlines how to set up and run the Celery services for this project.

## Prerequisites

1.  **Redis Server:** Ensure you have a Redis server installed and running.
    ```bash
    sudo apt update
    sudo apt install redis-server
    # Verify it's running
    redis-cli ping
    # Expected output: PONG
    ```

2.  **Python Dependencies:** Install all project requirements.
    ```bash
    # Activate your virtual environment
    source ../venv/bin/activate
    # Install packages
    pip install -r ../requirements.txt
    ```

## Running Celery

You must run three main processes (in separate terminals) for the application to be fully functional.

### 1. Run Migrations

`django-celery-beat` creates database models for its schedules. You must run migrations first.

```bash
python manage.py migrate
```
### 2. Start the Django Server
The Celery tasks query the GraphQL endpoint, so the Django server must be running.



```bash
python manage.py runserver
```

### 3. Start the Celery Worker
The worker is the process that actually executes the tasks.
```bash
celery -A crm worker -l info
```

### 4. Start the Celery Beat Scheduler,

The "beat" process is the scheduler. It "wakes up" at the scheduled times and sends the tasks to the worker.
```bash
celery -A crm beat -l info

Verifying Logs
You can monitor the logs generated by the tasks:

Heartbeat Log (from django-crontab):
```

```bash

tail -f /tmp/crm_heartbeat_log.txt
CRM Report Log (from Celery):
```


```bash

tail -f /tmp/crm_report_log.txt
```